from telegram import InlineKeyboardMarkup, InlineKeyboardButton, Update
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes

TOKEN = "8346101623:AAGOAzzq3MP6xziGXd8zZnhRcb83uCNYzR4"

user_languages = {}

# --- /start ---
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    markup = InlineKeyboardMarkup([
        [InlineKeyboardButton("ğŸ‡°ğŸ‡¿ ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°", callback_data="lang_kz")],
        [InlineKeyboardButton("ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹", callback_data="lang_ru")],
        [InlineKeyboardButton("ğŸ‡¬ğŸ‡§ English", callback_data="lang_en")]
    ])
    await update.message.reply_text("ğŸ‘‹ Ğ¢Ñ–Ğ»Ğ´Ñ– Ñ‚Ğ°Ò£Ğ´Ğ°Ò£Ñ‹Ğ· / Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº / Choose language:", reply_markup=markup)


# --- Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ ---
async def show_main_menu(query, lang):
    if lang == "ru":
        text = "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚ Ğ®ĞšĞ£ Ğ¸Ğ¼. Ğœ.Ğ. ĞÑƒÑĞ·Ğ¾Ğ²Ğ°! ğŸ‘‹\n\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»:"
        buttons = [
            ("ğŸ“ ĞĞ±Ğ¸Ñ‚ÑƒÑ€Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼", "menu_applicants"),
            ("ğŸ“ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ°Ğ¼", "menu_students"),
            ("ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹", "menu_contacts"),
            ("â“ Ğ—Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ˜Ğ˜", "menu_ai"),
            ("ğŸŒ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº", "menu_lang")
        ]
    elif lang == "kz":
        text = "ÒšĞ¾Ñˆ ĞºĞµĞ»Ğ´Ñ–Ò£Ñ–Ğ· Ñ€ĞµÑĞ¼Ğ¸ Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚Ò›Ğ° Ğœ.Ğ. Ó˜ÑƒĞµĞ·Ğ¾Ğ² Ğ°Ñ‚Ñ‹Ğ½Ğ´Ğ°Ò“Ñ‹ ĞÒšĞ£! ğŸ‘‹\n\nĞœÓ™Ğ·Ñ–Ñ€Ğ´ĞµĞ½ Ğ±Ó©Ğ»Ñ–Ğ¼Ğ´Ñ– Ñ‚Ğ°Ò£Ğ´Ğ°Ò£Ñ‹Ğ·:"
        buttons = [
            ("ğŸ“ Ğ¢Ğ°Ğ»Ğ°Ğ¿ĞºĞµÑ€Ğ»ĞµÑ€Ğ³Ğµ", "menu_applicants"),
            ("ğŸ“ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‚ĞµÑ€Ğ³Ğµ", "menu_students"),
            ("ğŸ“ Ğ‘Ğ°Ğ¹Ğ»Ğ°Ğ½Ñ‹Ñ", "menu_contacts"),
            ("â“ Ğ¡Ò±Ñ€Ğ°Ò› Ò›Ğ¾Ñ AI", "menu_ai"),
            ("ğŸŒ Ğ¢Ñ–Ğ»Ğ´Ñ– Ğ°ÑƒÑ‹ÑÑ‚Ñ‹Ñ€Ñƒ", "menu_lang")
        ]
    else:
        text = "Welcome to the official chatbot of M.Auezov South Kazakhstan University! ğŸ‘‹\n\nChoose a section:"
        buttons = [
            ("ğŸ“ For Applicants", "menu_applicants"),
            ("ğŸ“ For Students", "menu_students"),
            ("ğŸ“ Contacts", "menu_contacts"),
            ("â“ Ask AI", "menu_ai"),
            ("ğŸŒ Change Language", "menu_lang")
        ]

    markup = InlineKeyboardMarkup([[InlineKeyboardButton(bt, callback_data=cb)] for bt, cb in buttons])
    await query.edit_message_text(text=text, reply_markup=markup)


# --- Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞ·Ñ‹ĞºĞ° ---
async def callback_language(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    lang = query.data.split("_")[1]
    user_languages[query.from_user.id] = lang
    await show_main_menu(query, lang)


# --- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¼ĞµĞ½Ñ ---
async def callback_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    lang = user_languages.get(query.from_user.id, "ru")

    # ğŸ”„ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº
    if query.data == "menu_lang":
        markup = InlineKeyboardMarkup([
            [InlineKeyboardButton("ğŸ‡°ğŸ‡¿ ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°", callback_data="lang_kz")],
            [InlineKeyboardButton("ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹", callback_data="lang_ru")],
            [InlineKeyboardButton("ğŸ‡¬ğŸ‡§ English", callback_data="lang_en")]
        ])
        await query.edit_message_text("ğŸ‘‹ Ğ¢Ñ–Ğ»Ğ´Ñ– Ñ‚Ğ°Ò£Ğ´Ğ°Ò£Ñ‹Ğ· / Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº / Choose language:", reply_markup=markup)
        return

    # ğŸ“ ĞĞ±Ğ¸Ñ‚ÑƒÑ€Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼
    if query.data == "menu_applicants":
        if lang == "ru":
            text = "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ±Ğ¸Ñ‚ÑƒÑ€Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²:"
            buttons = [
                ("ğŸ“„ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹", "app_docs"),
                ("ğŸ—“ Ğ¡Ñ€Ğ¾ĞºĞ¸ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸", "app_dates"),
                ("ğŸ¯ ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹", "app_programs"),
                ("ğŸ’° Ğ“Ñ€Ğ°Ğ½Ñ‚Ñ‹ Ğ¸ ÑÑ‚Ğ¸Ğ¿ĞµĞ½Ğ´Ğ¸Ğ¸", "app_grants"),
                ("ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸", "app_contacts"),
                ("â¬… ĞĞ°Ğ·Ğ°Ğ´", "main_menu")
            ]
        elif lang == "kz":
            text = "Ğ¢Ğ°Ğ»Ğ°Ğ¿ĞºĞµÑ€Ğ»ĞµÑ€Ğ³Ğµ Ğ°Ñ€Ğ½Ğ°Ğ»Ò“Ğ°Ğ½ Ğ°Ò›Ğ¿Ğ°Ñ€Ğ°Ñ‚:"
            buttons = [
                ("ğŸ“„ ÒšÒ±Ğ¶Ğ°Ñ‚Ñ‚Ğ°Ñ€", "app_docs"),
                ("ğŸ—“ ÒšĞ°Ğ±Ñ‹Ğ»Ğ´Ğ°Ñƒ Ğ¼ĞµÑ€Ğ·Ñ–Ğ¼Ğ´ĞµÑ€Ñ–", "app_dates"),
                ("ğŸ¯ Ğ‘Ğ°Ò“Ğ´Ğ°Ñ€Ğ»Ğ°Ğ¼Ğ°Ğ»Ğ°Ñ€", "app_programs"),
                ("ğŸ’° Ğ“Ñ€Ğ°Ğ½Ñ‚Ñ‚Ğ°Ñ€ Ğ¶Ó™Ğ½Ğµ ÑÑ‚Ğ¸Ğ¿ĞµĞ½Ğ´Ğ¸ÑĞ»Ğ°Ñ€", "app_grants"),
                ("ğŸ“ ÒšĞ°Ğ±Ñ‹Ğ»Ğ´Ğ°Ñƒ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸ÑÑÑ‹Ğ½Ñ‹Ò£ Ğ±Ğ°Ğ¹Ğ»Ğ°Ğ½Ñ‹ÑÑ‹", "app_contacts"),
                ("â¬… ĞÑ€Ñ‚Ò›Ğ°", "main_menu")
            ]
        else:
            text = "Information for applicants:"
            buttons = [
                ("ğŸ“„ Documents", "app_docs"),
                ("ğŸ—“ Admission dates", "app_dates"),
                ("ğŸ¯ Programs", "app_programs"),
                ("ğŸ’° Grants & Scholarships", "app_grants"),
                ("ğŸ“ Admission contacts", "app_contacts"),
                ("â¬… Back", "main_menu")
            ]
        markup = InlineKeyboardMarkup([[InlineKeyboardButton(bt, callback_data=cb)] for bt, cb in buttons])
        await query.edit_message_text(text=text, reply_markup=markup)
        return

    # ğŸ“ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ°Ğ¼ â†’ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸
    if query.data == "menu_students":
        if lang == "ru":
            text = "Ğ Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ²:\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:"
            buttons = [
                ("ğŸ“ Ğ‘Ğ°ĞºĞ°Ğ»Ğ°Ğ²Ñ€Ğ¸Ğ°Ñ‚", "stud_bachelor"),
                ("ğŸ“ ĞœĞ°Ğ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚ÑƒÑ€Ğ°", "stud_master"),
                ("ğŸ“ Ğ”Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‚ÑƒÑ€Ğ°", "stud_phd"),
                ("â¬… ĞĞ°Ğ·Ğ°Ğ´", "main_menu")
            ]
        elif lang == "kz":
            text = "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‚ĞµÑ€Ğ³Ğµ Ğ°Ñ€Ğ½Ğ°Ğ»Ò“Ğ°Ğ½ Ğ±Ó©Ğ»Ñ–Ğ¼:\nĞÒ›Ñƒ Ğ´ĞµÒ£Ğ³ĞµĞ¹Ñ–Ğ½ Ñ‚Ğ°Ò£Ğ´Ğ°Ò£Ñ‹Ğ·:"
            buttons = [
                ("ğŸ“ Ğ‘Ğ°ĞºĞ°Ğ»Ğ°Ğ²Ñ€Ğ¸Ğ°Ñ‚", "stud_bachelor"),
                ("ğŸ“ ĞœĞ°Ğ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚ÑƒÑ€Ğ°", "stud_master"),
                ("ğŸ“ Ğ”Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‚ÑƒÑ€Ğ°", "stud_phd"),
                ("â¬… ĞÑ€Ñ‚Ò›Ğ°", "main_menu")
            ]
        else:
            text = "For students:\nChoose your study level:"
            buttons = [
                ("ğŸ“ Bachelor", "stud_bachelor"),
                ("ğŸ“ Master", "stud_master"),
                ("ğŸ“ PhD", "stud_phd"),
                ("â¬… Back", "main_menu")
            ]
        markup = InlineKeyboardMarkup([[InlineKeyboardButton(bt, callback_data=cb)] for bt, cb in buttons])
        await query.edit_message_text(text=text, reply_markup=markup)
        return

    # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ: ğŸ“ Ğ‘Ğ°ĞºĞ°Ğ»Ğ°Ğ²Ñ€Ğ¸Ğ°Ñ‚
    if query.data == "stud_bachelor":
        if lang == "ru":
            text = "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ±Ğ°ĞºĞ°Ğ»Ğ°Ğ²Ñ€Ğ¸Ğ°Ñ‚):"
            buttons = [
                ("ğŸ“… Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", "bachelor_schedule"),
                ("ğŸ’° Ğ¡Ñ‚Ğ¸Ğ¿ĞµĞ½Ğ´Ğ¸Ğ¸", "bachelor_grants"),
                ("ğŸ  ĞĞ±Ñ‰ĞµĞ¶Ğ¸Ñ‚Ğ¸Ğµ", "bachelor_dorm"),
                ("ğŸ–¥ Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚", "bachelor_lk"),
                ("ğŸ“‘ Ğ”ĞµĞºĞ°Ğ½Ğ°Ñ‚ Ğ¸ ĞºÑƒÑ€Ğ°Ñ‚Ğ¾Ñ€", "bachelor_dean"),
                ("ğŸ€ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ°Ñ Ğ¶Ğ¸Ğ·Ğ½ÑŒ", "bachelor_life"),
                ("ğŸ†˜ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°", "bachelor_help"),
                ("â¬… ĞĞ°Ğ·Ğ°Ğ´", "menu_students")
            ]
        elif lang == "kz":
            text = "Ğ‘Ğ°ĞºĞ°Ğ»Ğ°Ğ²Ñ€Ğ¸Ğ°Ñ‚ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‚ĞµÑ€Ñ–Ğ½Ğµ Ğ°Ñ€Ğ½Ğ°Ğ»Ò“Ğ°Ğ½ Ğ°Ò›Ğ¿Ğ°Ñ€Ğ°Ñ‚:"
            buttons = [
                ("ğŸ“… Ğ¡Ğ°Ğ±Ğ°Ò› ĞºĞµÑÑ‚ĞµÑÑ–", "bachelor_schedule"),
                ("ğŸ’° Ğ¡Ñ‚Ğ¸Ğ¿ĞµĞ½Ğ´Ğ¸ÑĞ»Ğ°Ñ€", "bachelor_grants"),
                ("ğŸ  Ğ–Ğ°Ñ‚Ğ°Ò›Ñ…Ğ°Ğ½Ğ°", "bachelor_dorm"),
                ("ğŸ–¥ Ğ–ĞµĞºĞµ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚", "bachelor_lk"),
                ("ğŸ“‘ Ğ”ĞµĞºĞ°Ğ½Ğ°Ñ‚ Ğ¶Ó™Ğ½Ğµ ĞºÑƒÑ€Ğ°Ñ‚Ğ¾Ñ€", "bachelor_dean"),
                ("ğŸ€ Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‚Ñ–Ğº Ó©Ğ¼Ñ–Ñ€", "bachelor_life"),
                ("ğŸ†˜ ÒšĞ¾Ğ»Ğ´Ğ°Ñƒ", "bachelor_help"),
                ("â¬… ĞÑ€Ñ‚Ò›Ğ°", "menu_students")
            ]
        else:
            text = "Information for bachelor students:"
            buttons = [
                ("ğŸ“… Schedule", "bachelor_schedule"),
                ("ğŸ’° Scholarships", "bachelor_grants"),
                ("ğŸ  Dormitory", "bachelor_dorm"),
                ("ğŸ–¥ Personal account", "bachelor_lk"),
                ("ğŸ“‘ Dean & curator", "bachelor_dean"),
                ("ğŸ€ Student life", "bachelor_life"),
                ("ğŸ†˜ Support", "bachelor_help"),
                ("â¬… Back", "menu_students")
            ]
        markup = InlineKeyboardMarkup([[InlineKeyboardButton(bt, callback_data=cb)] for bt, cb in buttons])
        await query.edit_message_text(text=text, reply_markup=markup)
        return

    # ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹
    if query.data == "menu_contacts":
        text = "â˜ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹ ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ‚ĞµÑ‚Ğ°:\n\nğŸ“ Ğ¨Ñ‹Ğ¼ĞºĞµĞ½Ñ‚, Ğ¿Ñ€. Ğ¢Ğ°ÑƒĞºĞµ Ñ…Ğ°Ğ½Ğ°, 5\nğŸ“ +7 (7252) 32-17-37\nğŸŒ www.auezov.edu.kz"
        await query.edit_message_text(text=text)
        return

    # ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´
    if query.data == "main_menu":
        await show_main_menu(query, lang)
        return

    # â“ AI
    if query.data == "menu_ai":
        texts = {
            "ru": "ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ, Ğ¸ Ñ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒÑ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ.",
            "kz": "Ğ¡Ò±Ñ€Ğ°Ò“Ñ‹Ò£Ñ‹Ğ·Ğ´Ñ‹ Ğ¶Ğ°Ğ·Ñ‹Ò£Ñ‹Ğ·, Ğ¶Ğ°ÑƒĞ°Ğ¿ Ğ±ĞµÑ€ÑƒĞ³Ğµ Ñ‚Ñ‹Ñ€Ñ‹ÑĞ°Ğ¼Ñ‹Ğ½.",
            "en": "Type your question, and Iâ€™ll try to answer."
        }
        await query.edit_message_text(text=texts[lang])
        return


def main():
    app = Application.builder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(callback_language, pattern="^lang_"))
    app.add_handler(CallbackQueryHandler(callback_menu, pattern=".*"))  # Ğ²ÑĞµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
    print("âœ… Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½")
    app.run_polling()


if __name__ == "__main__":
    main()
